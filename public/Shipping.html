<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="Shipping.css" />
  <link rel="stylesheet" href="Navbar.css" />
  <title>Shipping Method</title>
</head>
<body>

  <!-- Navbar -->
  <div id="navbar-container"></div>

  <!-- Checkout Content -->
  <div class="checkout-container">

    <div class="left-section">

      <nav class="breadcrumb">
        <a href="#">Cart</a>
        <span>›</span>
        <a href="#">Information</a>
        <span>›</span>
        <span class="current">Shipping</span>
        <span>›</span>
        <span>Payment</span>
        <span>›</span>
        <span>Place Order</span>
      </nav>

      <div class="info-box">
        <div class="info-row">
          <label>Contact</label>
          <span id="contact-info"></span>
          <a href="#" id="change-contact">Change</a>
        </div>
        <div class="info-row">
          <label>Address</label>
          <span id="address-info"></span>
          <a href="#" id="change-address">Change</a>
        </div>
      </div>

      <h2>Shipping method</h2>

      <div class="shipping-option">
        <input type="radio" name="shipping" checked />
        <span>Orders outside of Nairobi will be delivered within 48 hours</span>
      </div>

      <a href="#" class="back-link">‹ Return to information</a>

      <button class="primary-btn">PAY NOW</button>

    </div>

    <div class="right-section">
      <div class="product-summary">
        <!-- Items will be dynamically inserted here -->
      </div>

      <div class="promo">
        <input type="text" placeholder="Enter Promo Code" />
        <button>Apply</button>
      </div>

      <div class="totals">
        <div class="row">
          <span>Subtotal</span>
          <span id="subtotal">KSh 0.00</span>
        </div>
        <div class="row">
          <span>Shipping</span>
          <span id="shipping-cost">Free!</span>
        </div>
        <hr />
        <div class="row total-row">
          <strong>Total</strong>
          <strong id="total">KSh 0.00</strong>
        </div>
        <p class="tax-note" id="tax-note">(includes KSh 0.00 Tax)</p>
      </div>

      <div class="secure">
        <h3>Secured Payments</h3>
        <img src="Assets/tomorrow.png" class="badge" />
        <div class="secure-box">
          Best in class security to ensure that your payments and data is secure.
        </div>
      </div>
    </div>

  </div>

  <!-- Footer -->
  <div id="footer-container"></div>
<script>
document.addEventListener("DOMContentLoaded", () => {
  // Load Navbar
  fetch("Navbar.html")
    .then(res => res.text())
    .then(html => document.getElementById("navbar-container").innerHTML = html)
    .catch(err => console.error("Navbar load failed:", err));

  // Load Footer
  fetch("footer.html")
    .then(res => res.text())
    .then(html => document.getElementById("footer-container").innerHTML = html)
    .catch(err => console.error("Footer load failed:", err));

  // Load shipping info
  let shippingInfo = JSON.parse(localStorage.getItem("shippingInfo")) || {};
  const contactInfoEl = document.getElementById("contact-info");
  const addressInfoEl = document.getElementById("address-info");

  function renderShippingInfo() {
    contactInfoEl.textContent = shippingInfo.email || "";
    addressInfoEl.textContent = `${shippingInfo.street || ""}, ${shippingInfo.apartment || ""}, ${shippingInfo.city || ""}, ${shippingInfo.region || ""}, ${shippingInfo.country || ""}`;
  }
  renderShippingInfo();

  // Edit contact
  document.getElementById("change-contact").addEventListener("click", e => {
    e.preventDefault();
    const input = document.createElement("input");
    input.type = "email";
    input.value = shippingInfo.email || "";
    contactInfoEl.replaceWith(input);
    input.focus();
    input.addEventListener("blur", () => {
      shippingInfo.email = input.value;
      localStorage.setItem("shippingInfo", JSON.stringify(shippingInfo));
      input.replaceWith(contactInfoEl);
      renderShippingInfo();
    });
  });

  // Edit address
  document.getElementById("change-address").addEventListener("click", e => {
    e.preventDefault();
    const textarea = document.createElement("textarea");
    textarea.value = `${shippingInfo.street || ""}, ${shippingInfo.apartment || ""}, ${shippingInfo.city || ""}, ${shippingInfo.region || ""}, ${shippingInfo.country || ""}`;
    addressInfoEl.replaceWith(textarea);
    textarea.focus();
    textarea.addEventListener("blur", () => {
      const parts = textarea.value.split(",").map(p => p.trim());
      shippingInfo.street = parts[0] || "";
      shippingInfo.apartment = parts[1] || "";
      shippingInfo.city = parts[2] || "";
      shippingInfo.region = parts[3] || "";
      shippingInfo.country = parts[4] || "";
      localStorage.setItem("shippingInfo", JSON.stringify(shippingInfo));
      textarea.replaceWith(addressInfoEl);
      renderShippingInfo();
    });
  });

  // Load cart items
  const cartItems = JSON.parse(localStorage.getItem("cart")) || [];
  const summaryContainer = document.querySelector(".product-summary");
  summaryContainer.innerHTML = "";

  let subtotal = 0;

  cartItems.forEach(product => {
    // Ensure price is numeric
    let priceNumber = parseFloat(String(product.price).replace(/[^0-9.-]+/g,"")) || 0;
    let quantity = parseInt(product.quantity) || 1;
    let total = priceNumber * quantity;
    subtotal += total;

    const itemDiv = document.createElement("div");
    itemDiv.className = "item";
    itemDiv.innerHTML = `
      <img src="${product.image}" alt="${product.title}" />
      <div class="details">
        <p class="title">${product.title}</p>
        <p class="old-price">${product.oldPrice || ""}</p>
        <p class="price">${product.price} x ${quantity}</p>
      </div>
      <p class="total">KSh ${total.toLocaleString('en-US', {minimumFractionDigits:2})}</p>
    `;
    summaryContainer.appendChild(itemDiv);
  });

  // Update totals properly
  const subtotalEl = document.getElementById("subtotal");
  const totalEl = document.getElementById("total");
  subtotalEl.textContent = `KSh ${subtotal.toLocaleString('en-US', {minimumFractionDigits:2})}`;
  totalEl.textContent = `KSh ${subtotal.toLocaleString('en-US', {minimumFractionDigits:2})}`;
  document.getElementById("tax-note").textContent = `(includes KSh 0.00 Tax)`;

  // PAY NOW button
  const payBtn = document.querySelector(".primary-btn");
  if (payBtn) {
    payBtn.addEventListener("click", () => {
      shippingInfo.orderTotal = subtotal.toFixed(2);
      localStorage.setItem("shippingInfo", JSON.stringify(shippingInfo));
      window.location.href = "paymentmodule.html";
    });
  }
});
</script>


</body>
</html>
