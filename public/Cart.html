<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cart</title>
  <link rel="stylesheet" href="Cart.css" />
  <!-- Navbar -->
  <div id="navbar-container"></div>
  <style>
    /* ========= TOAST ========= */
    .toast {
      position: fixed;
      bottom: -80px;
      left: 50%;
      transform: translateX(-50%);
      background: #6fbf2e;
      color: #fff;
      padding: 14px 20px;
      border-radius: 8px;
      min-width: 320px;
      max-width: 90%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 15px;
      font-size: 15px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      transition: bottom 0.35s ease, opacity 0.35s ease;
      opacity: 0;
      z-index: 9999;
    }

    .toast.show {
      bottom: 25px;
      opacity: 1;
    }

    .toast-close {
      background: none;
      border: none;
      color: #fff;
      font-size: 22px;
      cursor: pointer;
    }
  </style>
</head>

<body>

<div class="page">
  <main class="cart">
    <h1>Cart <span>(<span id="item-count">0</span> items)</span></h1>

    <section class="delivery">

      <!-- DELIVERY HEADER -->
      <div class="delivery-header toggle-delivery">
        <span class="icon">üì¶</span>
        <strong>Pickup and delivery options</strong>
        <span class="arrow">‚ñæ</span>
      </div>

      <!-- DELIVERY OPTIONS -->
      <div class="delivery-options open">
        <div class="option active">
          <div class="circle">üöö</div>
          <div>
            <strong>Shipping</strong>
            <small>All items available</small>
          </div>
        </div>

        <div class="option disabled">
          <div class="circle">üè¨</div>
          <div>
            <strong>Pickup</strong>
            <small>Not available</small>
          </div>
        </div>

        <div class="option disabled">
          <div class="circle">üõçÔ∏è</div>
          <div>
            <strong>Delivery</strong>
            <small>Not available</small>
          </div>
        </div>
      </div>

      <!-- SHIPPING BOX -->
      <div class="shipping-box"></div>

     <h2>Add Your Essentials</h2>
<div class="essentials">
  <div class="card">
    <div class="card-img">
      <img src="Assets/Gloves.jpg" alt="Gloves">
    </div>
    <div class="card-info">
      <span class="price-tag">$5.97</span>
      <button class="add-essential">+ Add</button>
    </div>
  </div>

  <div class="card">
    <div class="card-img">
      <img src="Assets/watch3.webp" alt="Watch">
    </div>
    <div class="card-info">
      <span class="price-tag">$4.97</span>
      <button class="add-essential">+ Add</button>
    </div>
  </div>

  <div class="card">
    <div class="card-img">
      <img src="Assets/watch3.webp" alt="Watch">
    </div>
    <div class="card-info">
      <span class="price-tag">$4.97</span>
      <button class="add-essential">+ Add</button>
    </div>
  </div>

  <div class="card">
    <div class="card-img">
      <img src="Assets/watch3.webp" alt="Watch">
    </div>
    <div class="card-info">
      <span class="price-tag">$4.97</span>
      <button class="add-essential">+ Add</button>
    </div>
  </div>

  <div class="card">
    <div class="card-img">
      <img src="Assets/watch3.webp" alt="Watch">
    </div>
    <div class="card-info">
      <span class="price-tag">$4.97</span>
      <button class="add-essential">+ Add</button>
    </div>
  </div>
</div>

    </section>
  </main>

  <aside class="summary">
   <button class="checkout" onclick="window.location.href='Checkout.html'">Continue to checkout</button>

    <div class="box">
      <div class="row">
        <span>Subtotal (<span id="summary-count">0</span> items)</span>
        <span id="subtotal">$0.00</span>
      </div>
      <div class="row">
        <span>Shipping</span><span class="free">Free</span>
      </div>
      <hr />
      <div class="row total">
        <strong>Estimated total</strong>
        <strong id="total">$0.00</strong>
      </div>
    </div>
  </aside>
</div>

<!-- TOAST -->
<div id="toast" class="toast">
  <span>‚úî Product added successfully</span>
  <button class="toast-close">&times;</button>
</div>

<script>
    // Load navbar
    fetch('Navbar.html')
        .then(res => res.text())
        .then(html => {
            document.getElementById('navbar-container').innerHTML = html;
            initNavbarSidebar();
        })
        .catch(err => console.error('Error loading navbar:', err));

const toast = document.getElementById("toast");
const toastClose = toast.querySelector(".toast-close");
let toastTimer;

function showToast(message) {
  toast.querySelector("span").textContent = "‚úî " + message;
  toast.classList.add("show");
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => toast.classList.remove("show"), 3000);
}

toastClose.onclick = () => toast.classList.remove("show");

// Load cart from localStorage
function loadCart() {
  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  const shippingBox = document.querySelector(".shipping-box");
  shippingBox.innerHTML = "";

  let subtotal = 0;
  let totalItems = 0;

  cart.forEach(product => {
    const price = typeof product.price === "string" 
                  ? parseFloat(product.price.replace(/[^\d.-]/g, "")) || 0
                  : Number(product.price) || 0;
    const qty = parseInt(product.quantity) || 0;
    const total = price * qty;
    subtotal += total;
    totalItems += qty;

    const item = document.createElement("div");
    item.className = "item";
    item.dataset.price = price;
    item.innerHTML = `
      <img src="${product.image}">
      <div class="item-info">
        <div class="price">$<span class="item-total">${total.toFixed(2)}</span> <span>$${price.toFixed(2)} ea</span></div>
        <p>${product.title}</p>
        <small>Free Holiday returns until Jan 31</small>
        <div class="actions">
          <button class="remove-btn">Remove</button>
          <button class="save-btn">Save for later</button>
          <div class="qty">
            <button class="minus">-</button>
            <span class="qty-value">${qty}</span>
            <button class="plus">+</button>
          </div>
        </div>
      </div>`;
    shippingBox.appendChild(item);
  });

  updateSummary(subtotal, totalItems);
}

// Update subtotal, total and item counts
function updateSummary(subtotal, totalItems) {
  document.getElementById("subtotal").textContent = `$${subtotal.toFixed(2)}`;
  document.getElementById("total").textContent = `$${subtotal.toFixed(2)}`;
  document.getElementById("item-count").textContent = totalItems;
  document.getElementById("summary-count").textContent = totalItems;
}

// Save current cart to localStorage
function saveCart() {
  const cart = [];
  document.querySelectorAll(".item").forEach(item => {
    const title = item.querySelector("p").textContent;
    const image = item.querySelector("img").src;
    const price = Number(item.dataset.price) || 0;
    const qty = parseInt(item.querySelector(".qty-value").textContent) || 0;
    cart.push({ title, image, price, quantity: qty });
  });
  localStorage.setItem("cart", JSON.stringify(cart));
}

// Update totals whenever items change
function updateCartTotals() {
  let subtotal = 0, totalItems = 0;
  document.querySelectorAll(".item").forEach(item => {
    const qty = parseInt(item.querySelector(".qty-value").textContent) || 0;
    const price = Number(item.dataset.price) || 0;
    item.querySelector(".item-total").textContent = (qty * price).toFixed(2);
    subtotal += qty * price;
    totalItems += qty;
  });
  updateSummary(subtotal, totalItems);
  saveCart();
}

// Event delegation
document.addEventListener("click", e => {
  if (e.target.classList.contains("plus")) {
    e.target.previousElementSibling.textContent++;
    updateCartTotals();
  }

  if (e.target.classList.contains("minus")) {
    const qty = e.target.nextElementSibling;
    if (+qty.textContent > 1) qty.textContent--;
    updateCartTotals();
  }

  if (e.target.classList.contains("remove-btn")) {
    e.target.closest(".item").remove();
    updateCartTotals();
    showToast("Product removed");
  }

  if (e.target.classList.contains("save-btn")) {
    e.target.closest(".item").remove();
    updateCartTotals();
    showToast("Saved for later");
  }

  if (e.target.classList.contains("add-essential")) {
    const card = e.target.closest(".card");
    const price = typeof card.querySelector(".price-tag").textContent === "string" 
                  ? parseFloat(card.querySelector(".price-tag").textContent.replace(/[^\d.-]/g, "")) || 0
                  : Number(card.querySelector(".price-tag").textContent) || 0;
    const img = card.querySelector("img").src;

    const item = document.createElement("div");
    item.className = "item";
    item.dataset.price = price;
    item.innerHTML = `
      <img src="${img}">
      <div class="item-info">
        <div class="price">$<span class="item-total">${price.toFixed(2)}</span> <span>$${price.toFixed(2)} ea</span></div>
        <p>Essential Item</p>
        <div class="actions">
          <button class="remove-btn">Remove</button>
          <button class="save-btn">Save for later</button>
          <div class="qty">
            <button class="minus">-</button>
            <span class="qty-value">1</span>
            <button class="plus">+</button>
          </div>
        </div>
      </div>`;
    document.querySelector(".shipping-box").appendChild(item);
    updateCartTotals();
    showToast("Product added successfully");
  }

  if (e.target.closest(".toggle-delivery")) {
    const options = document.querySelector(".delivery-options");
    options.classList.toggle("open");
    document.querySelector(".arrow").textContent =
      options.classList.contains("open") ? "‚ñ¥" : "‚ñæ";
  }

  // Load footer dynamically
  fetch("footer.html")
    .then(response => response.text())
    .then(data => {
      document.getElementById("footer-container").innerHTML = data;
    })
    .catch(err => console.error("Footer load error:", err));
});

// Initial load
loadCart();
</script>

</body>
<!-- FOOTER -->
<div id="footer-container"></div>

</html>
